# Railway Deployment Guide — mobileStoreWebApp

This document explains step-by-step how to deploy `mobileStoreWebApp` to Railway using the repository `Dockerfile` (recommended) or a Docker image pushed to GitHub Container Registry (GHCR).

Prerequisites
- Railway account and access to the project (or permission to create a new project).
- GitHub repo `vijesh1v/mobileStoreWebApp` connected to Railway (or ability to connect it).
- Docker + Docker Hub/GHCR credentials if you prefer to push the image manually.

Recommendation
- Use the repository `Dockerfile` and Railway's Docker builder. `railway.json` in the repo already sets builder to `DOCKER`.
- Add a Railway Persistent Disk and mount it for SQLite persistence.

Key values to set in Railway service environment:
- `PORT` = `5000` (or leave default, but the server expects `PORT` env)
- `NODE_ENV` = `production`
- `JWT_SECRET` = (a secure random string — required for authentication)
- `DATABASE_PATH` = `/app/server/data/store.db` (see disk mounting below)
- `CLIENT_URL` = `https://<your-frontend-url>` or leave blank if server will serve the client

Persistent Disk
- Create a persistent disk in Railway and mount it at the container path `/app/server/data`.
- This ensures the SQLite DB file `store.db` persists across restarts and deploys.

Two deployment options

Option A — Deploy from the repository Dockerfile (recommended)
1. In Railway, create a new project and connect your GitHub repository `vijesh1v/mobileStoreWebApp`.
2. Select `Deploy via Dockerfile` (Railway will use the repo `Dockerfile`).
3. In service settings, add a Persistent Disk and mount it at `/app/server/data`.
4. Add the environment variables listed above (esp. `JWT_SECRET` and `DATABASE_PATH=/app/server/data/store.db`).
5. Trigger a deploy. Watch the build logs for steps: node install, workspace build, and server image creation.
6. After deployment, check service logs for these messages:
   - `Using database path:` — confirms the server resolved the DB path.
   - `Database initialized successfully!` and `Seeded X products successfully!` — confirm DB seeding.

Option B — Deploy from a GHCR Docker image
1. Build and push the image from your machine or CI to GHCR (example steps below).
2. In Railway, choose 'Deploy from Image' and paste the image URL `ghcr.io/<GHUSER>/mobilestorewebapp:latest`.
3. Add the Persistent Disk, environment variables (same as above), and deploy.

Commands: build & push image to GHCR (local)
Replace `<GHUSER>` with your GitHub username and create a PAT with `write:packages` scope.

```bash
# Build image locally
docker build -t mobile-store-railway:latest .

# Tag for GHCR
docker tag mobile-store-railway:latest ghcr.io/<GHUSER>/mobilestorewebapp:latest

# Login to GHCR (use a PAT with write:packages)
echo "<GHCR_PAT>" | docker login ghcr.io -u <GHUSER> --password-stdin

# Push
docker push ghcr.io/<GHUSER>/mobilestorewebapp:latest
```

Alternatively, use the included GitHub Actions workflow (already present) that builds and pushes the Docker image to GHCR on push to `main`.

Post-deploy verification
- Health endpoint: `GET https://<railway-app>/api/health` should return HTTP 200.
- Products: `GET https://<railway-app>/api/products` should return JSON of seeded products.
- Server logs should include `Using database path:` and `Seeded` messages.

Notes & troubleshooting
- If the DB initialization runs every deploy and overwrites data, ensure the `DATABASE_PATH` points to the persistent disk path and that seeding only runs when DB is empty.
- Ensure `CLIENT_URL` matches your frontend origin to avoid CORS issues.
- Keep `JWT_SECRET` secure and rotate if necessary.

If you'd like, I can:
- Push the built image to GHCR from this environment (you must provide a GHCR PAT), or
- Walk you interactively through the Railway UI steps (I can provide click-by-click instructions), or
- Attempt to create a Railway deployment via Railway CLI if you provide API access/credentials.

Commands to validate after deploy (from your machine):
```bash
curl -i https://<railway-app>/api/health
curl -s https://<railway-app>/api/products | jq '. | length'
```

Last notes
- The repo already contains a multi-stage `Dockerfile`, a GHCR/GitHub Actions workflow and `railway.json` configured for Docker builds. Use Option A for simplest flow.

---
File generated by AI helper to continue Railway deployment.
